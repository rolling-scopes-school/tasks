## Модули
[HOME](../README.md)

Node.js любой файл воспринимает как модуль. В Node.js на данный момент используются 2 системы модулей: **CommonJS** (модули, используемые в Node.js по умолчанию, появились раньше) и **ECMAScript модули** (реализуют функционал JS, впервые появившийся в спецификации ECMAScript 2015). Они имеют существенные отличия друг от друга. В рамках данных материалов мы используем только **CommonJS** модули. 
Глобальных переменных вроде `__dirname`, `__filename`, `process` в Node.js [не так много](https://nodejs.org/dist/latest-v14.x/docs/api/globals.html). Остальной функционал реализован в виде подключаемых модулей.  
Преимущества использования модулей в Node.js:
* Лучшее структурирование кода — код, разбитый на модули, гораздо легче для понимания, поддержки, тестирования 
* Облегчение переиспользования кода — правильно написанный и документированный модуль легко может быть использован в нескольких местах в одном проекте, а также в разных проектах
* Инкапсуляция — содержимое модуля инкапсулировано, т.е. доступно исключительно внутри модуля. Разработчик сам решает, что импортировать в модуль и что экспортировать за пределы модуля
* Благодаря [кэшированию](https://nodejs.org/dist/latest-v14.x/docs/api/modules.html#modules_caching) модулей их многократный импорт не приводит к дополнительным издержкам производительности

Упрощенно, модули в Node.js можно разделить на 3 типа:  
1. Стандартные модули (core modules), которые мы получаем "из коробки", устанавливая Node.js на компьютер.
Примеры стандартных модулей:
  - [модуль path](module/path.md)
  - [модуль fs](module/fs.md)
  - [модуль os](module/os.md)
2. [Модули-пакеты](module/npm-module.md)
3. [Модули, которые разработчик создаёт самостоятельно](module/create-module.md)

### Стандартные модули
Они уже скомпилированы в двоичный код и описаны в документации. [Перечень стандартных модулей](https://nodejs.org/dist/latest-v14.x/docs/api/). Стандартные модули достаточно подключить и можно с ними работать.

Для подключения модуля используется функция `require()`  
Примеры подключения модулей:  
```js
const path = require('path');
const fs = require('fs');
const os = require('os');
```

### Модули-пакеты (Packages)
К модулям-пакетам относятся папки с кодом, описываемые при помощи находящегося в них файла `package.json`.
С модулями-пакетами  удобно работать при помощи менеджеров пакетов, таких как `npm` или `yarn`. Если мы хотим использовать уже написанные кем-то модули-пакеты (частый способ использования кода других разработчиков), их нужно установить, затем подключить, затем использовать.  
Установка модуля-пакета при помощи `npm` осуществляется командой  
```powershell
npm install <имя модуля>  
```

### Модули, которые разработчик создаёт самостоятельно
Создание модуля начинается с создания отдельного js-файла, в котором пишется код. Если модуль должен экспортировать что-либо наружу, это делается при помощи записи экспортируемого значения в качестве свойства специального объекта `module.exports`, либо его перезаписи.
Экспортируемые из одних модулей значения мы можем импортировать в других модулях. Как и в случае с другими типами модулей, импорт осуществляется при помощи функции `require()`, только в качестве аргумента функции вместо имени модуля указываем путь к файлу.

Работу с модулями в Node.js начнём с создания Node.js-приложения

### Создание Node.js-приложения
Создадим новый проект. Для этого создадим папку проекта, откроем её в VS Code и в терминале выполним команду  
```npm init -y```  
Параметр `-y` (Yes) означает, что мы соглашаемся со всеми настройками проекта по умолчанию.  
В папке проекта появляется файл `package.json`, который описывает созданное приложение.

### Установка модулей-пакетов через npm.
Установка модуля осуществляется командой  
```powershell
npm install <имя модуля>
```  
Установим модуля nodemon. Для этого в терминале выполним команду  
```powershell
npm install nodemon
```  
Удаление модуля:
```powershell
npm uninstall nodemon
```  

Установленные модули добавляются в папку `node_modules`, а информация о них добавляется в файл `package.json`. Кроме того, автоматически создается файл `package.lock.json`, гарантирующий идентичность пакетов у различных пользователей, а также выполняющий ряд других полезных функций. 
Если удалить папку `node_modules` и выполнить команду `npm install`, папка `node_modules` восстановится вместе со всеми добавленными модулями на основе записей в файле `package.json`.
Проекты, написанные на Node.js, добавляются на GitHub без папки `node_modules`, но с файлом `package.json`, а также `package.lock.json`. После скачивания такого проекта необходимо выполнить в терминале команду `npm install`, чтобы восстановить все установленные через `npm` модули.
