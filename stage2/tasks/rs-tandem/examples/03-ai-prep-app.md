# Пример 3: AI Prep App (Synthetic Data + AI Judge)

Тренажер на основе **заранее сгенерированного контента** и **AI-судьи**. Вместо генерации ответов "на лету", система сравнивает ответ пользователя с эталоном.

---

## Концепция

### Core Philosophy

1. **Content is Static (Pre-generated):** Задачи, тесты, подсказки и эталонные объяснения генерируются заранее оффлайн большой моделью (Например GPT-5). Это гарантирует качество.
2. **Small LLM is the Judge:** В рантайме модель не "думает", а "сравнивает". Она оценивает семантическую близость ответа юзера к эталону.
3. **Code Runner is Truth:** Код проверяется автотестами. LLM используется только для интерпретации ошибок (stderr → human-friendly hint).

## Архитектура

```
┌────────────────────────────────────────────────────────────────────┐
│                    OFFLINE (Admin)                                 │
│  LLM типа GPT-5 генерирует задачи + эталонные ответы + рубрики     │
│                         ↓                                          │
│                    PostgreSQL                                      │
└────────────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│                    RUNTIME (User)                           │
│  1. Показываем задачу из БД                                │
│  2. Пользователь отвечает                                  │
│  3. Small LLM (8B) СРАВНИВАЕТ ответ с эталоном             │
│  4. Возвращает score + feedback                            │
└─────────────────────────────────────────────────────────────┘
```

---

## Ключевые фичи

- **Theory Tasks:** Открытые вопросы, AI Judge оценивает семантическую близость к эталону
- **Coding Tasks:** Код проверяется автотестами, AI объясняет ошибки человеческим языком
- **Structured Feedback:** Рубрики показывают, какие критерии покрыты, какие — нет
- **Progress Matrix:** Навыковая матрица по темам
- **Hint System:** Уровневые подсказки (не сразу ответ, а наводящие вопросы)

---

## Пример декомпозиции команды (3 студента + ментор)

| Участник      | Feature Components                            | Что изучит                                           |
| ------------- | --------------------------------------------- | ---------------------------------------------------- |
| **Student 1** | Task Viewer, Code Editor, Submissions, Hints  | Monaco/CodeMirror, form state, debouncing            |
| **Student 2** | Dashboard, Progress Matrix, Rubrics, History  | Data visualization, tables, charts                   |
| **Student 3** | Judge Client, Feedback UI, Scores, Comparison | LLM structured outputs, JSON parsing, UX для AI      |
| **Mentor**    | Generator Script, Code Runner, Judge API, DB  | Python/OpenAI API, Docker/Judge0, prompt engineering |

---

## User Journey

### Daily Loop: Theory Task

1. **System:** Показывает вопрос: _"В чем разница между `interface` и `type` в TS?"_
2. **User:** Пишет свой ответ (текстом)
3. **System (AI Judge):**
   - Берет ответ пользователя
   - Берет из БД скрытый `golden_answer` и `grading_rubric`
   - Запускает Small LLM с промптом: _"Сравни ответ с эталоном по критериям A, B, C"_
4. **Feedback:**
   - Показывает оценку: "80/100"
   - Показывает комментарий: _"Ты верно сказал про расширение, но забыл упомянуть union-типы"_

### Daily Loop: Coding Task

1. **System:** Показывает условие + редактор
2. **User:** Сабмитит решение
3. **Code Runner:** Запускает Unit-тесты
4. **Result:**
   - _Pass:_ +XP, обновляем матрицу навыков
   - _Fail:_ AI получает stderr и выбирает релевантную подсказку

---

## Страницы приложения

| Страница  | URL          | Описание                  |
| --------- | ------------ | ------------------------- |
| Landing   | `/`          | Главная с описанием       |
| Login     | `/login`     | Вход                      |
| Register  | `/register`  | Регистрация               |
| Dashboard | `/dashboard` | Прогресс, матрица навыков |
| Topics    | `/topics`    | Выбор темы                |
| Task      | `/task/:id`  | Решение задачи            |
| History   | `/history`   | История сабмитов          |
| Profile   | `/profile`   | Профиль пользователя      |

---

## Пример UI: Theory Task

```
┌─────────────────────────────────────────────────────────────┐
│  AI Prep > Core JS > Closures                    [Submit]   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Вопрос:                                                    │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Объясни, что такое замыкание (closure) в JavaScript.│   │
│  │ Приведи пример.                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  Твой ответ:                                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Замыкание это когда функция имеет доступ к         │   │
│  │ переменным из внешней функции...                   │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  AI Judge:                                      Score: 65%  │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ [x] Упомянул лексическое окружение                  │   │
│  │ [x] Объяснил сохранение переменных                  │   │
│  │ [ ] Не привёл пример кода                           │   │
│  │ [ ] Не упомянул практическое применение             │   │
│  │                                                     │   │
│  │ Tip: Добавь пример с counter-функцией и объясни,   │   │
│  │      зачем замыкания используют на практике.        │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  [Показать эталонный ответ]  [Следующий вопрос]            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## Пример UI: Coding Task

```
┌─────────────────────────────────────────────────────────────┐
│  AI Prep > Algorithms > Debounce              [Run] [Submit]│
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Задача:                                                    │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Реализуй функцию debounce(fn, delay), которая       │   │
│  │ откладывает вызов fn до тех пор, пока не пройдёт    │   │
│  │ delay миллисекунд с последнего вызова.              │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ function debounce(fn, delay) {                      │   │
│  │   // your code here                                 │   │
│  │                                                     │   │
│  │ }                                                   │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  Test Results:                                              │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ [x] should delay execution                          │   │
│  │ [x] should cancel previous timeout                  │   │
│  │ [ ] should pass arguments to fn          FAILED    │   │
│  │ [ ] should preserve this context         FAILED    │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  AI Hint:                                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Похоже, ты забыл передать аргументы в fn.           │   │
│  │ Используй rest parameters (...args) и spread.       │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  [Hint Level 2]  [Show Solution]                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

### Пример задачи в БД

```json
{
  "id": "task_closure_01",
  "topic_id": "core_js",
  "type": "theory_open",
  "difficulty": 3,
  "content": {
    "question_text": "Объясни, что такое замыкание (closure) в JavaScript. Приведи пример."
  },
  "secret_data": {
    "golden_answer": "Замыкание — это функция, которая запоминает своё лексическое окружение даже после того, как внешняя функция завершила выполнение. Это позволяет внутренней функции иметь доступ к переменным внешней функции...",
    "rubric_items": [
      "Упомянул лексическое окружение",
      "Объяснил сохранение переменных",
      "Привёл корректный пример",
      "Упомянул практическое применение"
    ],
    "hints": [
      "Подумай, что происходит с переменными внешней функции",
      "Вспомни, как работает область видимости в JS"
    ]
  }
}
```

---

## AI Judge: Technical Details

### Prompt Template (Theory Evaluation)

```
ROLE: You are a strict technical interviewer.
TASK: Compare the CANDIDATE_ANSWER with the REFERENCE_ANSWER based on the RUBRIC.

REFERENCE_ANSWER: {secret_data.golden_answer}
RUBRIC_POINTS: {secret_data.rubric_items}

CANDIDATE_ANSWER: {user_input}

OUTPUT FORMAT (JSON):
{
  "score": 0-100,
  "covered_points": ["point 1"],
  "missed_points": ["point 2"],
  "feedback": "Short constructive feedback explaining what is missing."
}
```

### Prompt Template (Code Error Explanation)

```
ROLE: You are a helpful coding assistant.
TASK: Explain the error in simple terms and suggest a fix direction (not the full solution).

ERROR_LOG: {stderr}
USER_CODE: {user_code}
AVAILABLE_HINTS: {hints}

Choose the most relevant hint or rephrase the error in simple terms.
Do NOT give the full solution, only guide the user.
```

---

## Why This Architecture?

| Риск                       | Решение                                                                        |
| -------------------------- | ------------------------------------------------------------------------------ |
| **Галлюцинации LLM**       | LLM не генерирует теорию, только сравнивает. Эталон статичен и проверен.       |
| **Маленькая модель глупа** | Сравнить два текста проще, чем написать эссе. Для судьи 8B LLM хватает.        |
| **Latency**                | Не нужен RAG поиск по 1000 чанков. Контекст загружается одним запросом из SQL. |
| **Проблемы промптов**      | Промпт для оценки один и тот же. Его легко отладить.                           |
| **JSON Errors**            | Сложные JSON-структуры управляются оффлайн. В рантайме только простой ввод.    |

---

## Code Runner Options

### Option A: Judge0 (Recommended)

- Open-source code execution system
- Поддерживает 60+ языков
- Sandbox из коробки
- Self-hosted или SaaS

### Option B: Docker-based Runner

- Простой контейнер с Node.js/Python
- Запуск тестов через child_process
- Нужна своя система таймаутов и изоляции

### Option C: WebContainer (Browser-based)

- Запуск Node.js прямо в браузере
- Без backend для кода
- Ограничения по возможностям

---

## Примеры дополнительных фич

- **Leaderboard:** Рейтинг по темам
- **Spaced Repetition:** Повторение слабых тем
- **Interview Simulation:** Таймер + серия вопросов
- **Code Playback:** Просмотр своего решения по шагам
- **Peer Review:** Сравнение своего ответа с ответами других
