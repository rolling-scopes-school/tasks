# Риски и митигации: Custom Backend + Judge0

Специфические риски для Варианта A и стратегии их смягчения.

> **Архитектура и навигация**: [README.md](./README.md)

---

## 1. Mentor SPOF (Single Point of Failure)

**Риск:** Mentor — единственный человек, владеющий бэкендом (Express + PostgreSQL + Judge0). Если ментор выбывает или перегружен, весь бэкенд встаёт.

**Митигация:**

- **Mock API Layer с первого дня.** Фронтенд-разработчики (Nika, Oscar, Paula) работают с моками (`USE_MOCK=true`) и не зависят от бэкенда до Sprint 2.
- **Контракты до кода.** Согласуйте [data-contracts.md](./data-contracts.md) на первой неделе. TypeScript интерфейсы фиксируют API — даже если бэкенд задерживается, фронтенд продолжает.
- **Парное программирование.** Один из студентов (например Paula) проводит 2-3 парные сессии с Mentor на неделях 1-2, чтобы понимать серверный код.
- **Fallback: Supabase.** Если бэкенд критически отстаёт к неделе 3, переключайтесь на [Вариант B](../variant-b/) — интерфейсы одинаковы, меняется только реализация.

---

## 2. Judge0 Rate Limits

**Риск:** Бесплатный Judge0 CE на RapidAPI имеет лимиты (50-100 submissions/день). На демо может закончиться квота.

**Митигация:**

- **Self-hosted Judge0 (Docker).** Для разработки поднимайте Judge0 локально — без лимитов. См. [code-runner.md](./code-runner.md).
- **Кэширование.** Одинаковый код + одинаковые тесты → возвращайте cached результат.
- **Demo fallback.** Подготовьте 5-10 pre-recorded результатов для демо. Если Judge0 недоступен, показывайте cached ответы.
- **Платный план.** Judge0 CE на RapidAPI имеет план за $10/мес с 5000 submissions. Для демо этого достаточно.

---

## 3. Cold Start (Render Free Tier)

**Риск:** Render free tier усыпляет сервер после 15 минут неактивности. Первый запрос после сна занимает 30-60 секунд.

**Митигация:**

- **Cron ping.** Бесплатные сервисы типа [cron-job.org](https://cron-job.org) пингуют ваш сервер каждые 14 минут, не давая ему заснуть.
- **Loading state.** Покажите пользователю "Сервер просыпается..." при первом запросе.
- **Платный план.** Render Starter ($7/мес) не спит. Для финального демо — оправданная инвестиция.
- **Railway альтернатива.** [Railway](https://railway.app) имеет аналогичный free tier, но с другими лимитами.

---

## 4. Безопасность: API ключи

**Риск:** Groq API Key или Judge0 API Key попадают в клиентский код или в git.

**Митигация:**

- **Все ключи на сервере.** Клиент никогда не вызывает Groq или Judge0 напрямую — только через Express endpoints.
- **`.env` в `.gitignore`.** Проверьте это в первый же день.
- **Environment variables.** На Render/Railway ключи задаются через Dashboard, не в коде.
- **`.env.example`.** Создайте файл с шаблоном (без реальных ключей) для onboarding новых разработчиков.

---

## 5. PostgreSQL: миграции и seed data

**Риск:** Схема базы данных меняется, и разработчики работают с разными версиями.

**Митигация:**

- **SQL миграции в git.** Храните файлы миграций (`001_create_tables.sql`, `002_add_index.sql`) в репозитории.
- **Seed script.** Автоматический скрипт для заполнения базы тестовыми данными (10+ задач, 2+ темы).
- **Docker Compose.** Один файл для запуска PostgreSQL + Express + Judge0 локально. Все разработчики работают с идентичным окружением.

---

## 6. Сложность интеграции

**Риск:** Много точек интеграции (Frontend → Express → PostgreSQL → Groq → Judge0). Каждая может сломаться.

**Митигация:**

- **Послойное тестирование.** Тестируйте каждый слой отдельно: Postman для API, unit tests для сервисов, mock mode для фронтенда.
- **Health check endpoint.** `GET /api/health` возвращает статус всех зависимостей (DB, Groq, Judge0).
- **Structured logging.** Используйте `console.log` с JSON-форматом для отладки на Render.
- **Sprint 1 = моки.** Первые 2 недели фронтенд работает полностью на моках. Интеграция начинается со Sprint 2.
